<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>Jora Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <style>
    body { font-family: system-ui, sans-serif; background:#f2f2f2; padding:40px; }
    .box {
      background:white; padding:24px; max-width:380px; margin:auto;
      border-radius:14px; box-shadow:0 8px 20px rgba(0,0,0,0.08);
    }
    h2 { margin-top:0; }
    input, button {
      width:100%; padding:12px; margin-top:10px; border-radius:10px;
      border:1px solid #ccc; font-size:16px;
    }
    button {
      background:#0a84ff; color:white; font-weight:600; border:none;
    }
    #error { color:#d00; margin-top:10px; display:none; }
    .hidden { display:none; }
  </style>
</head>

<body>

<!-- LOGIN PANEL -->
<div class="box" id="loginBox">
  <h2>Autentificare</h2>
  <input id="username" placeholder="Nume utilizator" />
  <input id="password" type="password" placeholder="Parola" />
  <button onclick="doLogin()">IntrƒÉ √Æn cont</button>
  <p id="error">Date incorecte</p>
</div>

<!-- SESSION BANNER PANEL -->
<div class="box hidden" id="bannerBox">
  <h2>Bine ai revenit!</h2>
  <p id="bannerText">Se √ÆncarcƒÉ datele‚Ä¶</p>

  <button id="resumeBtn" class="hidden"></button>

  <button onclick="newContract()">üÜï Contract nou</button>
  <button onclick="editContract()">‚úèÔ∏è Editare contract</button>
  <button onclick="qa()">üí¨ Q&A</button>
</div>


<script>
// ------------ CONFIG -------------------
const LOGIN_URL = "https://YOUR_N8N_DOMAIN/webhook/jora-login";
const SESSION_URL = "https://YOUR_N8N_DOMAIN/webhook/jora-get-session";
const BOT_USERNAME = "YourTelegramBotUsername"; // EX: JoraAssistantBot
// ---------------------------------------

let telegramId = null;

// STEP 1 ‚Äî LOGIN
async function doLogin() {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  const response = await fetch(LOGIN_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password })
  }).then(r => r.json());

  if (!response.success) {
    document.getElementById("error").style.display = "block";
    return;
  }

  telegramId = response.telegram_id;

  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("bannerBox").classList.remove("hidden");

  loadSession();
}

// STEP 2 ‚Äî LOAD SESSION BANNER
async function loadSession() {
  const res = await fetch(`${SESSION_URL}?telegram_id=${telegramId}`)
    .then(r => r.json());

  const text = document.getElementById("bannerText");
  const resumeBtn = document.getElementById("resumeBtn");

  if (!res.can_resume) {
    text.textContent = "Ce vrei sƒÉ faci?";
    return;
  }

  // Build dynamic session title
  text.textContent = `Vrei sƒÉ reiei sesiunea ‚Äû${res.session_title}‚Äù?`;

  // Configure resume button
  resumeBtn.classList.remove("hidden");
  resumeBtn.textContent = "üî∑ ContinuƒÉ sesiunea";

  const payload = `${res.resume_intent}_${res.contract_number || ""}`;

  resumeBtn.onclick = () => {
    window.location.href = `https://t.me/${BOT_USERNAME}?start=${payload}`;
  };
}

// STEP 3 ‚Äî Redirect actions
function newContract() {
  window.location.href = `https://t.me/${BOT_USERNAME}?start=new_contract`;
}
function editContract() {
  window.location.href = `https://t.me/${BOT_USERNAME}?start=edit_contract`;
}
function qa() {
  window.location.href = `https://t.me/${BOT_USERNAME}?start=qa`;
}
</script>

</body>
</html>
