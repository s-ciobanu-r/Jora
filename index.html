<!DOCTYPE html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jora Assistant</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: #f6f6f6;
      }
      h1 { font-size: 22px; margin-bottom: 8px; text-align: center; }
      p  { color: #444; text-align: center; margin-bottom: 24px; }
      button {
        width: 240px;
        margin: 8px 0;
        padding: 12px 20px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 10px;
        color: #fff;
        background: #0a84ff;
        cursor: pointer;
        transition: background 0.2s ease;
      }
      button:hover { background: #0066cc; }
    </style>
  </head>

  <body>
    <h1>ğŸ‘‹ Bun venit la Jora Assistant</h1>
    <p id="sessionText">Vrei sÄƒ reiei sesiunea sau sÄƒ alegi altceva?</p>

    <button id="resume">ğŸ”· Reia sesiunea</button>
    <button id="new">ğŸ†• Contract nou</button>
    <button id="edit">âœï¸ Editare contract</button>
    <button id="qa">ğŸ’¬ ÃntrebÄƒri & rÄƒspunsuri</button>

    <script>
      const tg = window.Telegram.WebApp;
      tg.expand();

      const sessionEl = document.getElementById("sessionText");

      // 1ï¸âƒ£ Read possible session title from URL params
      const urlParams = new URLSearchParams(window.location.search);
      const sessionTitle = urlParams.get("session_title");

      // 2ï¸âƒ£ Or optionally fetch from your n8n webhook
      async function fetchSession() {
        if (sessionTitle) return sessionTitle; // already provided via URL
        try {
          // Example: call your n8n webhook to get latest session
          const resp = await fetch(
            "https://n8n.yourdomain.com/webhook/get-session?telegram_id=" +
              (tg.initDataUnsafe?.user?.id || "")
          );
          const data = await resp.json();
          return data.session_title; // expects { "session_title": "creare contract nr 2025-43" }
        } catch (e) {
          console.warn("fetch session failed", e);
          return null;
        }
      }

      // 3ï¸âƒ£ Render dynamic text
      (async () => {
        const title = await fetchSession();
        if (title) {
          sessionEl.textContent = `Vrei sÄƒ reiei sesiunea â€${title}â€ sau sÄƒ alegi altceva?`;
        }
      })();

      // 4ï¸âƒ£ sendData bridge
      function sendAction(action) {
        try {
          tg.sendData(action);
        } catch (e) {
          alert("Would send: " + action); // for browser testing
        }
        tg.close();
      }

      document.getElementById("resume").onclick = () => sendAction("resume_session");
      document.getElementById("new").onclick = () => sendAction("new_contract");
      document.getElementById("edit").onclick = () => sendAction("edit_contract");
      document.getElementById("qa").onclick = () => sendAction("qa");
    </script>
  </body>
</html>
